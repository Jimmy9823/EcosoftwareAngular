<div class="d-flex">

  <!-- BARRA LATERAL -->
  <app-barra-lateral 
    [menu]="menu" 
    [vistaActual]="vistaActual" 
    [nombreUsuario]="nombreUsuario"
    (vistaChange)="cambiarVista($event)" 
    (logout)="logout()"
    (edit)="editarPerfil()">
  </app-barra-lateral>

  <!-- CONTENIDO PRINCIPAL -->
  <main class="dashboard administrador flex-fill p-4">

    <!-- PANEL DE CONTROL -->
    <ng-container *ngIf="vistaActual === 'panel'">
      
      <app-titulo 
        titulo="Panel de Control" 
        subtitulo="Resumen de análisis y métricas de la plataforma"
        iconoBoton="bi bi-bell"
        colorBoton="outline-custom-success" 
        hoverColorBoton="custom-success-filled">
      </app-titulo>

      <!-- Auth status removed -->

      <!-- FILA 1: Gráficos principales -->
      <div class="analytics-grid">
        
        <!-- Gráfico 1: Usuarios por Localidad (Línea/Barras) -->
        <div class="analytics-card">
          <h6 class="card-title">Usuarios por Localidad</h6>
          <div class="chart-container">
            <app-grafico-usuarios-localidad></app-grafico-usuarios-localidad>
          </div>
        </div>

        <!-- (Removed) Distribución por Barrio - usuario solicitó eliminar -->

        <!-- Gráfico 3: Solicitudes por Localidad -->
        <div class="analytics-card">
          <h6 class="card-title">Solicitudes por Localidad</h6>
          <div class="chart-container">
            <app-solicitudes-localidad-chart></app-solicitudes-localidad-chart>
          </div>
        </div>

      </div>

      <!-- FILA 2: Indicadores complementarios -->
      <div class="analytics-grid mt-4">
        
        <!-- Rechazadas por Motivo -->
        <div class="analytics-card">
          <h6 class="card-title">Solicitudes Rechazadas</h6>
          <div class="chart-container">
            <app-rechazadas-motivo-chart></app-rechazadas-motivo-chart>
          </div>
        </div>

        <!-- Pendientes vs Aceptadas -->
        <div class="analytics-card">
          <h6 class="card-title">Estado de Solicitudes</h6>
          <div class="chart-container">
            <app-pendientes-aceptadas-chart></app-pendientes-aceptadas-chart>
          </div>
        </div>

      </div>

    </ng-container>
<ng-container *ngIf="vistaActual === 'editar-perfil'">
      <app-titulo
        titulo="Editar Perfil"
        subtitulo="Actualiza tu información personal"
        iconoBoton="bi bi-eye"
        colorBoton="outline-custom-success"
        
        >
        
      </app-titulo>
      <app-editar-usuario></app-editar-usuario>
</ng-container>
    <!-- USUARIOS -->

    <ng-container *ngIf="vistaActual === 'usuarios'">

      <app-titulo 
        titulo="Usuarios" 
        subtitulo="Gestión de usuarios del sistema"
        [textoBoton]="mostrarNuevoUsuario ? 'Mostrar usuarios' : 'Agregar nuevo usuario'"
        iconoBoton="bi bi-plus-circle"
        colorBoton="outline-custom-success"
        hoverColorBoton="custom-success-filled"
        (clickBoton)="toggleNuevoUsuario()">
      </app-titulo>

      <div class="contenedor-toggle">

        <!-- Agregar usuario -->
        <ng-container *ngIf="mostrarNuevoUsuario">
          <div class="contenido-solicitud">
            <!-- En cualquier template -->
          <!-- En el dashboard de administrador -->
<app-registro-admin></app-registro-admin>
          </div>
        </ng-container>

        <!-- Lista de usuarios -->
        <ng-container *ngIf="!mostrarNuevoUsuario">
          <div class="contenido-solicitud">
             <app-usuario-tabla></app-usuario-tabla>

            <div *ngIf="!cargando && usuarios.length === 0"
              class="alert alert-warning text-center shadow-sm py-2 mt-3">
              No se encontraron usuarios registrados.
            </div>
          </div>
        </ng-container>

      </div>
    </ng-container>

    <!-- SOLICITUDES -->
    <ng-container *ngIf="vistaActual === 'solicitudes'">
      <app-titulo 
        titulo="Solicitudes de Recolección" 
        subtitulo="Gestión de solicitudes de recolección">
      </app-titulo>
      <app-solcitudes></app-solcitudes>
    </ng-container>

    <!-- RECOLECCIONES -->
    <ng-container *ngIf="vistaActual === 'recolecciones'">
      <app-titulo 
        titulo="Recolecciones" 
        subtitulo="Gestión de recolecciones">
      </app-titulo>

      <app-listar-tabla></app-listar-tabla>
    </ng-container>

    <!-- PUNTOS DE RECICLAJE -->
    <ng-container *ngIf="vistaActual === 'puntos'">
      <app-titulo 
        titulo="Puntos de Reciclaje" 
        subtitulo="Listado y gestión de puntos" 
        iconoBoton="bi bi-plus-circle"
        colorBoton="outline-custom-success"
        hoverColorBoton="custom-success-filled"
        (clickBoton)="openCreateFromTitulo()">
      </app-titulo>

      <div class="mt-3">
        <app-crud-puntos></app-crud-puntos>
      </div>
    </ng-container>

    <!-- CAPACITACIONES -->
    <ng-container *ngIf="vistaActual === 'capacitaciones'">
      <app-titulo 
        titulo="Capacitaciones y Módulos"
        subtitulo="Gestión de capacitaciones y módulos"
        [textoBoton]="capacitaciones ? 'Mostrar capacitaciones' : 'Mostrar Módulos'"
        iconoBoton="bi bi-plus-circle"
        colorBoton="outline-custom-success"
        hoverColorBoton="custom-success-filled"
        (clickBoton)="toggleVista()">
      </app-titulo>

      <div class="contenedor-toggle">

        <!-- Lista de capacitaciones -->
        <ng-container *ngIf="capacitaciones">
          <div class="contenido-solicitud">
            <h3 class="fw-bold verde-principal mb-1">Capacitaciones</h3>
            <p class="text-muted mb-0">Consulta tus capacitaciones</p>
          </div>
        </ng-container>

        <!-- Módulos -->
        <ng-container *ngIf="!capacitaciones">
          <div class="contenido-solicitud">
            <app-carga-masiva-capacitacion></app-carga-masiva-capacitacion>
            <app-listar-capacitaciones></app-listar-capacitaciones>
          </div>
        </ng-container>

      </div>
    </ng-container>

    <!-- NOTICIAS -->
    <ng-container *ngIf="vistaActual === 'noticias'">
      <app-titulo 
        titulo="Noticias" 
        subtitulo="Gestión de noticias y novedades">
      </app-titulo>
    </ng-container>

  </main>

</div>

