<!-- =============================== -->
<!-- ALERTAS FIJAS ARRIBA A LA DERECHA -->
<!-- =============================== -->
<div class="alertas-container">
  <div *ngIf="mensaje" class="alert alert-success alert-dismissible fade show" role="alert">
    {{ mensaje }}
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>

  <div *ngIf="error" class="alert alert-danger alert-dismissible fade show" role="alert">
    {{ error }}
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>
</div>

<!-- =============================== -->
<!-- CONTENEDOR PRINCIPAL DE TABLA Y FILTROS -->
<!-- =============================== -->
<div class="tabla-container">

  <!-- =============================== -->
<!-- FILTROS CON FormComp Y BOTÓN LIMPIAR -->
<!-- =============================== -->
<div class=" filtros-container ">
  <!-- FormComp ocupa la mayor parte -->
  <div class="form-wrapper">
    <app-form-comp
  [formGroup]="formFiltros"
  [fields]="fieldsFiltros"
  [submitButtonIcon]="'bi bi-funnel'"
  [submitButtonColor]="'custom-success-filled'"  
  (submitForm)="aplicarFiltroDesdeForm()">
</app-form-comp>
  </div>

  <!-- Botón Limpiar -->
  <div class="limpiar-wrapper">
    <app-boton
      icono="bi bi-brush"
      color="custom-gray-filled"
      (click)="limpiarFiltro()">
    </app-boton>
  </div>
</div>



  <!-- =============================== -->
  <!-- TABLA DE USUARIOS -->
  <!-- =============================== -->
  <app-tabla
    [columnas]="columnasUsuarios"
    [data]="usuarios"
    [cellTemplates]="cellTemplatesUsuarios"
    titulo="Usuarios"
    (descargar)="abrirModalReportes()"
    (eliminar)="abrirModalEliminar($event)">
  </app-tabla>

  <!-- MENSAJE CUANDO NO HAY USUARIOS -->
  <div *ngIf="usuarios.length === 0 && !cargando" class="mensaje info">
    No hay usuarios registrados.
  </div>

</div>

<!-- =============================== -->
<!-- MODAL DE REPORTES -->
<!-- =============================== -->
<app-modal
  #modalReportes
  [title]="'Reportes de usuarios'"
  [headerColor]="'#6c757d'"
  [isOpen]="false">
  
  <div class="mb-3">
    Seleccione el formato de reporte a descargar:
  </div>

  <div class="d-flex gap-2 justify-content-center flex-wrap">
    <app-boton
      *ngFor="let btn of botonesReporte"
      [texto]="btn.texto"
      [icono]="btn.icono"
      [color]="btn.color"
      (click)="btn.accion()">
    </app-boton>
  </div>

</app-modal>

<!-- =============================== -->
<!-- MODAL ELIMINAR USUARIO -->
<!-- =============================== -->
<app-modal
  #modalEliminar
  [title]="'Eliminar usuario'"
  [headerColor]="'#d9534f'"
  [isOpen]="false">

  <div class="p-2">
    <p>
      ¿Estás seguro que deseas realizar una de estas acciones para el usuario 
      <strong>{{ usuarioSeleccionado?.nombre }}</strong>?
    </p>
    
    <!-- Información adicional del usuario -->
    <div class="user-info mt-3 p-2 bg-light rounded">
      <div><strong>Correo:</strong> {{ usuarioSeleccionado?.correo }}</div>
      <div><strong>Teléfono:</strong> {{ usuarioSeleccionado?.telefono }}</div>
      <div>
        <strong>Rol:</strong> 
        {{ usuarioSeleccionado && usuarioSeleccionado.rolId ? obtenerNombreRol(usuarioSeleccionado.rolId) : 'No especificado' }}
      </div>
      <div>
        <strong>Estado:</strong> 
        <span [class]="usuarioSeleccionado?.estado ? 'text-success' : 'text-danger'">
          {{ usuarioSeleccionado?.estado ? 'Activo' : 'Inactivo' }}
        </span>
      </div>
    </div>
    
    <!-- Explicación de las opciones -->
    <div class="mt-3">
      <div class="alert alert-warning">
        <i class="bi bi-info-circle"></i>
        <strong>Inactivar:</strong> Cambia el estado del usuario a "Inactivo". Podrá ser reactivado posteriormente.
      </div>
      <div class="alert alert-danger">
        <i class="bi bi-exclamation-triangle"></i>
        <strong>Eliminar:</strong> Elimina permanentemente el usuario del sistema. Esta acción no se puede deshacer.
      </div>
    </div>
  </div>

  <!-- FOOTER CON BOTONES DINÁMICOS -->
  <ng-container footer>
    <div class="d-flex justify-content-end gap-2">
      <app-boton
        *ngFor="let btn of accionesEliminar"
        [texto]="btn.texto"
        [icono]="btn.icono"
        [color]="btn.color"
        size="sm"
        (click)="btn.accion()">
      </app-boton>
    </div>
  </ng-container>

</app-modal>
