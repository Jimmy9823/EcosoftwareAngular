<div class="tabla-container">
  <h2>Gestión de Usuarios</h2>

  <div *ngIf="cargando" class="mensaje info">Cargando usuarios...</div>
  <div *ngIf="mensaje" class="mensaje exito">{{ mensaje }}</div>
  <div *ngIf="error" class="mensaje error">{{ error }}</div>

  <table class="tabla-usuarios" *ngIf="usuarios.length > 0">
    <thead>
      <tr>
        <th>ID</th>
        <th>Nombre</th>
        <th>Correo</th>
        <th>Teléfono</th>
        <th>Rol</th>
        <th>Estado</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let usuario of usuarios">
        <td>{{ usuario.idUsuario }}</td>

        <!-- Nombre -->
        <td *ngIf="editandoId !== usuario.idUsuario">{{ usuario.nombre }}</td>
        <td *ngIf="editandoId === usuario.idUsuario">
          <input [(ngModel)]="usuarioEditado.nombre" />
        </td>

        <!-- Correo -->
        <td *ngIf="editandoId !== usuario.idUsuario">{{ usuario.correo }}</td>
        <td *ngIf="editandoId === usuario.idUsuario">
          <input [(ngModel)]="usuarioEditado.correo" />
        </td>

        <!-- Teléfono -->
        <td *ngIf="editandoId !== usuario.idUsuario">{{ usuario.telefono }}</td>
        <td *ngIf="editandoId === usuario.idUsuario">
          <input [(ngModel)]="usuarioEditado.telefono" />
        </td>

        <!-- Rol -->
        <td *ngIf="editandoId !== usuario.idUsuario">{{ obtenerNombreRol(usuario.rolId) }}</td>
        <td *ngIf="editandoId === usuario.idUsuario">
          <select [(ngModel)]="usuarioEditado.rolId">
            <option *ngFor="let r of roles" [value]="r.id">{{ r.nombre }}</option>
          </select>
        </td>

        <!-- Estado -->
        <td>
          <span [class.activo]="usuario.estado" [class.inactivo]="!usuario.estado">
            {{ usuario.estado ? 'Activo' : 'Inactivo' }}
          </span>
        </td>

        <!-- Acciones -->
        <td class="acciones">
          <button *ngIf="editandoId !== usuario.idUsuario" class="btn editar" (click)="activarEdicion(usuario)">Editar</button>
          <button *ngIf="editandoId === usuario.idUsuario" class="btn guardar" (click)="guardarCambios(usuario)">Guardar</button>
          <button *ngIf="editandoId === usuario.idUsuario" class="btn cancelar" (click)="cancelarEdicion()">Cancelar</button>
          <button class="btn eliminar" (click)="eliminarUsuario(usuario.idUsuario!)">Eliminar</button>
        </td>
      </tr>
    </tbody>
  </table>

  <div *ngIf="usuarios.length === 0 && !cargando" class="mensaje info">
    No hay usuarios registrados.
  </div>
</div>
